<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duck Song - Got Any Grapes?</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        #gameContainer {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #gameCanvas {
            border: 4px solid #8B4513;
            border-radius: 8px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }
        #ui {
            display: flex;
            gap: 30px;
            margin-bottom: 10px;
            color: white;
            font-size: 18px;
            background: rgba(0,0,0,0.5);
            padding: 10px 20px;
            border-radius: 20px;
        }
        #instructions {
            color: #aaa;
            margin-top: 10px;
            text-align: center;
            font-size: 14px;
        }
        #title {
            color: #FFD700;
            font-size: 28px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        #musicBtn {
            background: #FFD700;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            transition: transform 0.1s;
        }
        #musicBtn:hover {
            transform: scale(1.05);
        }
        #startScreen, #winScreen {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
        }
        .screen-btn {
            background: #FFD700;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-family: inherit;
            font-size: 20px;
            margin-top: 20px;
            transition: transform 0.1s, background 0.2s;
        }
        .screen-btn:hover {
            transform: scale(1.1);
            background: #FFA500;
        }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="title">The Duck Song Game - Got Any Grapes?</div>
        <div id="ui">
            <span>Grapes: <span id="grapeCount">0</span></span>
            <span>Level: <span id="levelNum">1</span></span>
            <button id="musicBtn" onclick="toggleMusic()">Music: OFF</button>
        </div>
        <canvas id="gameCanvas" width="800" height="500"></canvas>
        <div id="instructions">
            Arrow Keys or WASD to move | SPACE to jump | Collect all grapes to advance!
        </div>

        <div id="startScreen">
            <h1 style="color: #FFD700; font-size: 36px;">The Duck Song Game</h1>
            <p style="margin: 20px 0; font-size: 18px;">Help the duck collect grapes!<br>Visit the lemonade stand along the way.</p>
            <p style="color: #aaa;">Controls: Arrow Keys / WASD + Space</p>
            <button class="screen-btn" onclick="startGame()">Start Game!</button>
        </div>

        <div id="winScreen" class="hidden">
            <h1 style="color: #FFD700; font-size: 36px;">You Win!</h1>
            <p style="margin: 20px 0; font-size: 18px;">The duck finally got all the grapes!</p>
            <p style="color: #8B008B;">Total grapes collected: <span id="totalGrapes">0</span></p>
            <button class="screen-btn" onclick="startGame()">Play Again</button>
        </div>
    </div>

    <audio id="bgMusic" loop>
        <source src="duck_song.mp3" type="audio/mpeg">
    </audio>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const grapeCountEl = document.getElementById('grapeCount');
        const levelNumEl = document.getElementById('levelNum');
        const musicBtn = document.getElementById('musicBtn');
        const bgMusic = document.getElementById('bgMusic');
        const startScreen = document.getElementById('startScreen');
        const winScreen = document.getElementById('winScreen');

        // Game state
        let gameRunning = false;
        let keys = {};
        let grapes = [];
        let platforms = [];
        let level = 1;
        let grapesCollected = 0;
        let totalGrapesCollected = 0;
        let totalGrapes = 0;
        let gameMessage = '';
        let messageTimer = 0;
        let musicPlaying = false;

        const MAX_LEVEL = 5;

        // Duck player
        const duck = {
            x: 100,
            y: 300,
            width: 50,
            height: 60,
            vx: 0,
            vy: 0,
            speed: 5,
            jumpForce: -14,
            onGround: false,
            facing: 1,
            walkFrame: 0,
            walkTimer: 0
        };

        // Lemonade stand
        const lemonadeStand = {
            x: 600,
            y: 280,
            width: 120,
            height: 150
        };

        // Physics
        const gravity = 0.6;
        const friction = 0.85;

        function toggleMusic() {
            if (musicPlaying) {
                bgMusic.pause();
                musicBtn.textContent = 'Music: OFF';
                musicPlaying = false;
            } else {
                bgMusic.play().catch(e => console.log('Audio play failed:', e));
                musicBtn.textContent = 'Music: ON';
                musicPlaying = true;
            }
        }

        // Draw the duck (cartoon style)
        function drawDuck(x, y, facing, walkFrame) {
            ctx.save();
            ctx.translate(x + duck.width/2, y + duck.height/2);
            ctx.scale(facing, 1);
            ctx.translate(-duck.width/2, -duck.height/2);

            // Body (yellow oval)
            ctx.fillStyle = '#FFB830';
            ctx.beginPath();
            ctx.ellipse(25, 35, 22, 28, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Head
            ctx.fillStyle = '#FFB830';
            ctx.beginPath();
            ctx.arc(30, 12, 16, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();

            // Beak (orange)
            ctx.fillStyle = '#FF6B35';
            ctx.beginPath();
            ctx.moveTo(44, 10);
            ctx.lineTo(60, 14);
            ctx.lineTo(44, 18);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // Eye (white with black pupil)
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.ellipse(36, 8, 6, 7, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();

            // Pupil
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(38, 8, 3, 0, Math.PI * 2);
            ctx.fill();

            // Legs
            ctx.strokeStyle = '#FF6B35';
            ctx.lineWidth = 3;
            const legOffset = Math.sin(walkFrame * 0.3) * 5;

            ctx.beginPath();
            ctx.moveTo(18, 58);
            ctx.lineTo(15 - legOffset, 70);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(32, 58);
            ctx.lineTo(35 + legOffset, 70);
            ctx.stroke();

            // Feet
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(10 - legOffset, 70);
            ctx.lineTo(20 - legOffset, 70);
            ctx.moveTo(30 + legOffset, 70);
            ctx.lineTo(40 + legOffset, 70);
            ctx.stroke();

            ctx.restore();
        }

        // Draw a grape bunch
        function drawGrape(x, y, size) {
            const grapeColor = '#8B008B';
            const highlight = '#9932CC';

            ctx.strokeStyle = '#228B22';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(x, y - size);
            ctx.lineTo(x, y - size - 10);
            ctx.stroke();

            ctx.fillStyle = '#228B22';
            ctx.beginPath();
            ctx.ellipse(x + 5, y - size - 8, 8, 4, 0.3, 0, Math.PI * 2);
            ctx.fill();

            const positions = [
                {dx: 0, dy: 0},
                {dx: -size*0.7, dy: -size*0.4},
                {dx: size*0.7, dy: -size*0.4},
                {dx: -size*0.35, dy: size*0.5},
                {dx: size*0.35, dy: size*0.5},
                {dx: 0, dy: size*0.9}
            ];

            positions.forEach(pos => {
                ctx.fillStyle = grapeColor;
                ctx.beginPath();
                ctx.arc(x + pos.dx, y + pos.dy, size * 0.5, 0, Math.PI * 2);
                ctx.fill();
                ctx.strokeStyle = '#4B0082';
                ctx.lineWidth = 1;
                ctx.stroke();

                ctx.fillStyle = highlight;
                ctx.beginPath();
                ctx.arc(x + pos.dx - 2, y + pos.dy - 2, size * 0.15, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // Draw lemonade stand
        function drawLemonadeStand(x, y) {
            // Stand base
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(x, y + 70, 120, 80);
            ctx.strokeStyle = '#5D2E0C';
            ctx.lineWidth = 3;
            ctx.strokeRect(x, y + 70, 120, 80);

            // Counter top
            ctx.fillStyle = '#A0522D';
            ctx.fillRect(x - 5, y + 65, 130, 10);

            // Sign board
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(x + 10, y - 30, 100, 40);
            ctx.strokeRect(x + 10, y - 30, 100, 40);

            // Sign text
            ctx.fillStyle = '#FFD700';
            ctx.font = 'bold 12px Comic Sans MS';
            ctx.textAlign = 'center';
            ctx.fillText('ICE FRESH', x + 60, y - 12);

            ctx.fillStyle = '#FFD700';
            ctx.font = 'bold 14px Comic Sans MS';
            ctx.fillText('Lemonade', x + 60, y + 90);

            // Roof poles
            ctx.strokeStyle = '#8B4513';
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.moveTo(x + 20, y - 30);
            ctx.lineTo(x + 20, y + 70);
            ctx.moveTo(x + 100, y - 30);
            ctx.lineTo(x + 100, y + 70);
            ctx.stroke();

            // Lemonade pitcher
            ctx.fillStyle = '#FFFF99';
            ctx.beginPath();
            ctx.ellipse(x + 45, y + 55, 12, 15, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.beginPath();
            ctx.arc(x + 58, y + 55, 8, -Math.PI/2, Math.PI/2);
            ctx.stroke();

            // Lemonade man
            ctx.fillStyle = '#FDBF6F';
            ctx.beginPath();
            ctx.arc(x + 75, y + 30, 15, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();

            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.arc(x + 75, y + 22, 14, Math.PI, 2 * Math.PI);
            ctx.fill();

            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(x + 70, y + 28, 4, 0, Math.PI * 2);
            ctx.arc(x + 80, y + 28, 4, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(x + 70, y + 28, 2, 0, Math.PI * 2);
            ctx.arc(x + 80, y + 28, 2, 0, Math.PI * 2);
            ctx.fill();

            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(x + 75, y + 40, 5, 0.2 * Math.PI, 0.8 * Math.PI);
            ctx.stroke();

            ctx.fillStyle = '#4169E1';
            ctx.fillRect(x + 60, y + 45, 30, 25);
        }

        // Draw background
        function drawBackground() {
            // Sky gradient
            const skyGradient = ctx.createLinearGradient(0, 0, 0, 300);
            skyGradient.addColorStop(0, '#87CEEB');
            skyGradient.addColorStop(1, '#B0E0E6');
            ctx.fillStyle = skyGradient;
            ctx.fillRect(0, 0, canvas.width, 300);

            // Sun
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(720, 60, 35, 0, Math.PI * 2);
            ctx.fill();

            for (let i = 0; i < 8; i++) {
                const angle = (i / 8) * Math.PI * 2;
                ctx.strokeStyle = '#FFD700';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(720 + Math.cos(angle) * 40, 60 + Math.sin(angle) * 40);
                ctx.lineTo(720 + Math.cos(angle) * 55, 60 + Math.sin(angle) * 55);
                ctx.stroke();
            }

            // Hills
            ctx.fillStyle = '#3CB371';
            ctx.beginPath();
            ctx.moveTo(0, 250);
            ctx.quadraticCurveTo(200, 180, 400, 250);
            ctx.quadraticCurveTo(600, 180, 800, 250);
            ctx.lineTo(800, 300);
            ctx.lineTo(0, 300);
            ctx.closePath();
            ctx.fill();

            // City silhouette
            ctx.fillStyle = '#696969';
            ctx.fillRect(50, 180, 30, 70);
            ctx.fillRect(85, 200, 25, 50);
            ctx.fillRect(115, 170, 35, 80);
            ctx.fillRect(155, 190, 20, 60);

            // Tree
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(180, 200, 15, 100);
            ctx.fillStyle = '#228B22';
            ctx.beginPath();
            ctx.arc(187, 180, 40, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(170, 200, 30, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(205, 195, 32, 0, Math.PI * 2);
            ctx.fill();

            // Ground
            ctx.fillStyle = '#32CD32';
            ctx.fillRect(0, 300, canvas.width, 200);

            // Grass texture
            ctx.strokeStyle = '#228B22';
            ctx.lineWidth = 1;
            for (let i = 0; i < canvas.width; i += 15) {
                ctx.beginPath();
                ctx.moveTo(i, 300);
                ctx.lineTo(i + 3, 295);
                ctx.moveTo(i + 7, 300);
                ctx.lineTo(i + 10, 293);
                ctx.stroke();
            }

            // Level indicator
            ctx.fillStyle = 'rgba(0,0,0,0.2)';
            ctx.font = 'bold 60px Comic Sans MS';
            ctx.textAlign = 'center';
            ctx.fillText('LEVEL ' + level, canvas.width/2, 180);
        }

        // Draw platforms
        function drawPlatform(p) {
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(p.x, p.y + 10, p.width, p.height - 10);

            ctx.fillStyle = '#32CD32';
            ctx.fillRect(p.x, p.y, p.width, 15);

            ctx.strokeStyle = '#228B22';
            ctx.lineWidth = 1;
            for (let i = p.x; i < p.x + p.width; i += 10) {
                ctx.beginPath();
                ctx.moveTo(i + 2, p.y);
                ctx.lineTo(i + 4, p.y - 5);
                ctx.stroke();
            }

            ctx.strokeStyle = '#5D2E0C';
            ctx.lineWidth = 2;
            ctx.strokeRect(p.x, p.y, p.width, p.height);
        }

        // Generate level
        function generateLevel(levelNum) {
            platforms = [];
            grapes = [];
            grapesCollected = 0;

            // Ground platform
            platforms.push({x: 0, y: 430, width: 800, height: 70});

            const configs = {
                1: {
                    platforms: [
                        {x: 80, y: 350, width: 100, height: 20},
                        {x: 250, y: 280, width: 100, height: 20},
                        {x: 420, y: 350, width: 100, height: 20}
                    ],
                    grapes: [{x: 130, y: 320}, {x: 300, y: 250}, {x: 470, y: 320}, {x: 200, y: 400}]
                },
                2: {
                    platforms: [
                        {x: 50, y: 360, width: 100, height: 20},
                        {x: 220, y: 290, width: 100, height: 20},
                        {x: 390, y: 220, width: 100, height: 20}
                    ],
                    grapes: [{x: 100, y: 330}, {x: 270, y: 260}, {x: 440, y: 190}, {x: 300, y: 400}, {x: 500, y: 400}]
                },
                3: {
                    platforms: [
                        {x: 30, y: 370, width: 90, height: 20},
                        {x: 180, y: 300, width: 90, height: 20},
                        {x: 330, y: 230, width: 90, height: 20},
                        {x: 480, y: 300, width: 90, height: 20}
                    ],
                    grapes: [{x: 75, y: 340}, {x: 225, y: 270}, {x: 375, y: 200}, {x: 525, y: 270}, {x: 150, y: 400}, {x: 400, y: 400}]
                },
                4: {
                    platforms: [
                        {x: 20, y: 370, width: 80, height: 20},
                        {x: 150, y: 300, width: 80, height: 20},
                        {x: 280, y: 230, width: 80, height: 20},
                        {x: 410, y: 160, width: 80, height: 20}
                    ],
                    grapes: [{x: 60, y: 340}, {x: 190, y: 270}, {x: 320, y: 200}, {x: 450, y: 130}, {x: 250, y: 400}, {x: 500, y: 400}]
                },
                5: {
                    platforms: [
                        {x: 30, y: 380, width: 80, height: 20},
                        {x: 160, y: 310, width: 80, height: 20},
                        {x: 290, y: 240, width: 80, height: 20},
                        {x: 420, y: 170, width: 80, height: 20},
                        {x: 290, y: 100, width: 80, height: 20}
                    ],
                    grapes: [{x: 70, y: 350}, {x: 200, y: 280}, {x: 330, y: 210}, {x: 460, y: 140}, {x: 330, y: 70}, {x: 150, y: 400}, {x: 450, y: 400}]
                }
            };

            const config = configs[levelNum] || configs[5];

            config.platforms.forEach(p => {
                platforms.push({x: p.x, y: p.y, width: p.width, height: p.height});
            });

            config.grapes.forEach(g => {
                grapes.push({x: g.x, y: g.y, size: 12, collected: false});
            });

            totalGrapes = grapes.length;
            duck.x = 50;
            duck.y = 350;
            duck.vx = 0;
            duck.vy = 0;
        }

        function checkPlatformCollision() {
            duck.onGround = false;

            for (const p of platforms) {
                if (duck.x + duck.width > p.x &&
                    duck.x < p.x + p.width &&
                    duck.y + duck.height > p.y &&
                    duck.y + duck.height < p.y + p.height + duck.vy + 5 &&
                    duck.vy >= 0) {

                    duck.y = p.y - duck.height;
                    duck.vy = 0;
                    duck.onGround = true;
                }
            }
        }

        function checkGrapeCollection() {
            for (const grape of grapes) {
                if (!grape.collected) {
                    const dx = (duck.x + duck.width/2) - grape.x;
                    const dy = (duck.y + duck.height/2) - grape.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);

                    if (dist < 40) {
                        grape.collected = true;
                        grapesCollected++;
                        totalGrapesCollected++;
                        showMessage("Got a grape!");

                        if (grapesCollected === totalGrapes) {
                            if (level >= MAX_LEVEL) {
                                showMessage("You Win! Got ALL the grapes!");
                                setTimeout(() => {
                                    gameRunning = false;
                                    document.getElementById('totalGrapes').textContent = totalGrapesCollected;
                                    winScreen.classList.remove('hidden');
                                }, 1500);
                            } else {
                                showMessage("Level Complete!");
                                setTimeout(() => {
                                    level++;
                                    generateLevel(level);
                                }, 1500);
                            }
                        }
                    }
                }
            }
        }

        function showMessage(msg) {
            gameMessage = msg;
            messageTimer = 90;
        }

        function update() {
            if (!gameRunning) return;

            // Input
            if (keys['ArrowLeft'] || keys['KeyA']) {
                duck.vx = -duck.speed;
                duck.facing = -1;
            } else if (keys['ArrowRight'] || keys['KeyD']) {
                duck.vx = duck.speed;
                duck.facing = 1;
            } else {
                duck.vx *= friction;
            }

            if ((keys['Space'] || keys['ArrowUp'] || keys['KeyW']) && duck.onGround) {
                duck.vy = duck.jumpForce;
                duck.onGround = false;
            }

            duck.vy += gravity;
            duck.x += duck.vx;
            duck.y += duck.vy;

            // Boundaries
            if (duck.x < 0) duck.x = 0;
            if (duck.x + duck.width > canvas.width) duck.x = canvas.width - duck.width;

            // Fall off screen
            if (duck.y > canvas.height + 50) {
                duck.x = 50;
                duck.y = 350;
                duck.vy = 0;
                showMessage("Whoops! Try again!");
            }

            // Walk animation
            if (Math.abs(duck.vx) > 0.5) {
                duck.walkTimer++;
                if (duck.walkTimer > 5) {
                    duck.walkFrame++;
                    duck.walkTimer = 0;
                }
            } else {
                duck.walkFrame = 0;
            }

            checkPlatformCollision();
            checkGrapeCollection();

            // Update UI
            grapeCountEl.textContent = grapesCollected + '/' + totalGrapes;
            levelNumEl.textContent = level;

            if (messageTimer > 0) messageTimer--;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            drawBackground();

            // Platforms
            for (const p of platforms) {
                if (p.y < 430) drawPlatform(p);
            }

            // Lemonade stand
            drawLemonadeStand(lemonadeStand.x, lemonadeStand.y);

            // Grapes
            for (const grape of grapes) {
                if (!grape.collected) drawGrape(grape.x, grape.y, grape.size);
            }

            // Duck
            drawDuck(duck.x, duck.y, duck.facing, duck.walkFrame);

            // Speech bubble when near stand
            if (duck.x > 500 && duck.x < 700 && duck.y > 350) {
                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.ellipse(680, 250, 70, 30, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.stroke();

                ctx.fillStyle = 'white';
                ctx.beginPath();
                ctx.moveTo(660, 275);
                ctx.lineTo(670, 290);
                ctx.lineTo(680, 275);
                ctx.fill();
                ctx.stroke();

                ctx.fillStyle = '#000';
                ctx.font = 'bold 12px Comic Sans MS';
                ctx.textAlign = 'center';
                ctx.fillText("We only sell", 680, 245);
                ctx.fillText("LEMONADE!", 680, 260);
            }

            // Message
            if (messageTimer > 0) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(200, 20, 400, 50);
                ctx.fillStyle = '#FFD700';
                ctx.font = 'bold 24px Comic Sans MS';
                ctx.textAlign = 'center';
                ctx.fillText(gameMessage, 400, 52);
            }
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        function startGame() {
            startScreen.classList.add('hidden');
            winScreen.classList.add('hidden');

            level = 1;
            totalGrapesCollected = 0;
            generateLevel(1);
            gameRunning = true;

            // Auto-play music when game starts
            if (!musicPlaying) {
                bgMusic.play().catch(e => console.log('Audio play failed:', e));
                musicBtn.textContent = 'Music: ON';
                musicPlaying = true;
            }
        }

        // Event listeners
        document.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            if (['Space', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.code)) {
                e.preventDefault();
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });

        // Initialize
        generateLevel(1);
        gameLoop();
    </script>
</body>
</html>
